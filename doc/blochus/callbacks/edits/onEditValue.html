<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of onEditValue</title>
  <meta name="keywords" content="onEditValue">
  <meta name="description" content=" updates all edit field values, checks for wrong inputs and">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # blochus --><!-- # callbacks --><!-- menu.html edits -->
<h1>onEditValue
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> updates all edit field values, checks for wrong inputs and</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function onEditValue(src,~) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">onEditValue updates all edit field values, checks for wrong inputs and
restores a default value if necessary

 Syntax:
       onEditValue(src)

 Inputs:
       src - handle of the calling object

 Outputs:
       none

 Example:
       onEditValue(src)

 Other m-files required:
       getB0
       getOmega0
       getPulseParameters
       getRampParameters
       plotPulse
       plotRamp

 Subfunctions:
       createDataString

 MAT-files required:
       none

 See also: BLOCHUS
 Author: Thomas Hiller
 email: thomas.hiller[at]leibniz-liag.de
 License: GNU GPLv3 (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="onEditValue.html" class="code" title="function onEditValue(src,~)">onEditValue</a>	 updates all edit field values, checks for wrong inputs and</li><li><a href="../../../blochus/callbacks/popup/onPopupPrePolRamp.html" class="code" title="function onPopupPrePolRamp(src,~)">onPopupPrePolRamp</a>	 selects the pre-polarization switch-off ramp</li><li><a href="../../../blochus/functions/blochsim/getB0.html" class="code" title="function B = getB0(gamma,omega0)">getB0</a>	 calculates the magnetic field from a given angular frequency and</li><li><a href="../../../blochus/functions/blochsim/getOmega0.html" class="code" title="function omega0 = getOmega0(gamma,B)">getOmega0</a>	 calculates the angular frequency from a given B-field and</li><li><a href="../../../blochus/functions/interface/getPulseParameters.html" class="code" title="function getPulseParameters(fig)">getPulseParameters</a>	 updates all relevant pulse settings</li><li><a href="../../../blochus/functions/interface/getRampParameters.html" class="code" title="function getRampParameters(fig)">getRampParameters</a>	 updates all relevant switch-off ramp settings</li><li><a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>	 plots different pulse parameter</li><li><a href="../../../blochus/functions/interface/plotRamp.html" class="code" title="function plotRamp(fig)">plotRamp</a>	 plots different pre-polarization switch-off ramp parameter</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../blochus/BLOCHUS/BLOCHUS_createPanelBasic.html" class="code" title="function [gui,myui] = BLOCHUS_createPanelBasic(data,gui,myui)">BLOCHUS_createPanelBasic</a>	 creates "Basic" settings panel</li><li><a href="../../../blochus/BLOCHUS/BLOCHUS_createPanelPrePol.html" class="code" title="function [gui,myui] = BLOCHUS_createPanelPrePol(data,gui,myui)">BLOCHUS_createPanelPrePol</a>	 creates "Pre-polarization" settings panel</li><li><a href="../../../blochus/BLOCHUS/BLOCHUS_createPanelPulse.html" class="code" title="function [gui,myui] = BLOCHUS_createPanelPulse(data,gui,myui)">BLOCHUS_createPanelPulse</a>	 creates "Pulse" settings panel</li><li><a href="onEditValue.html" class="code" title="function onEditValue(src,~)">onEditValue</a>	 updates all edit field values, checks for wrong inputs and</li><li><a href="../../../blochus/callbacks/popup/onPopupNucleus.html" class="code" title="function onPopupNucleus(src,~)">onPopupNucleus</a>	 selects the nucleus (proton) to use for the simulation</li><li><a href="../../../blochus/callbacks/popup/onPopupPulseType.html" class="code" title="function onPopupPulseType(src,~)">onPopupPulseType</a>	 selects the pulse type</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function out = createDataString(tag)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function onEditValue(src,~)</a>
0002 <span class="comment">%onEditValue updates all edit field values, checks for wrong inputs and</span>
0003 <span class="comment">%restores a default value if necessary</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Syntax:</span>
0006 <span class="comment">%       onEditValue(src)</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Inputs:</span>
0009 <span class="comment">%       src - handle of the calling object</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Outputs:</span>
0012 <span class="comment">%       none</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Example:</span>
0015 <span class="comment">%       onEditValue(src)</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% Other m-files required:</span>
0018 <span class="comment">%       getB0</span>
0019 <span class="comment">%       getOmega0</span>
0020 <span class="comment">%       getPulseParameters</span>
0021 <span class="comment">%       getRampParameters</span>
0022 <span class="comment">%       plotPulse</span>
0023 <span class="comment">%       plotRamp</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% Subfunctions:</span>
0026 <span class="comment">%       createDataString</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% MAT-files required:</span>
0029 <span class="comment">%       none</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% See also: BLOCHUS</span>
0032 <span class="comment">% Author: Thomas Hiller</span>
0033 <span class="comment">% email: thomas.hiller[at]leibniz-liag.de</span>
0034 <span class="comment">% License: GNU GPLv3 (at end)</span>
0035 
0036 <span class="comment">%------------- BEGIN CODE --------------</span>
0037 
0038 <span class="comment">% get GUI handle</span>
0039 fig = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0040 
0041 <span class="keyword">if</span> ~isempty(fig) &amp;&amp; strcmp(get(fig,<span class="string">'Tag'</span>),<span class="string">'BLOCHUS'</span>)
0042     <span class="comment">% get GUI data</span>
0043     gui = getappdata(fig,<span class="string">'gui'</span>);
0044     data = getappdata(fig,<span class="string">'data'</span>);
0045     
0046     <span class="comment">% get the value of the field</span>
0047     val = str2double(get(src,<span class="string">'String'</span>));
0048     <span class="comment">% get the tag of the edit field</span>
0049     tag = get(src,<span class="string">'Tag'</span>);
0050     <span class="comment">% get the user data of the field</span>
0051     ud = get(src,<span class="string">'UserData'</span>);
0052     
0053     <span class="comment">% get the default values [default min max]</span>
0054     defaults = ud.defaults;
0055     
0056     <span class="comment">% check if the value is numeric</span>
0057     <span class="comment">% if not reset to defaults stored in user data</span>
0058     <span class="keyword">if</span> isnan(val)
0059         set(src,<span class="string">'String'</span>,num2str(defaults(1)));
0060         val = str2double(get(src,<span class="string">'String'</span>));
0061     <span class="keyword">end</span>
0062     <span class="comment">% check if the value is out of bounds</span>
0063     <span class="comment">% if yes reset to default</span>
0064     <span class="keyword">if</span> val &lt; defaults(2) || val &gt; defaults(3)
0065         set(src,<span class="string">'String'</span>,num2str(defaults(1)));
0066         val = str2double(get(src,<span class="string">'String'</span>)); <span class="comment">%#ok&lt;*NASGU&gt;</span>
0067     <span class="keyword">end</span>
0068     
0069     <span class="comment">% get the data field to update from the field tag</span>
0070     out = <a href="#_sub1" class="code" title="subfunction out = createDataString(tag)">createDataString</a>(tag);
0071     <span class="comment">% update the corresponding data field</span>
0072     updstr = [out.updstr,<span class="string">'=val;'</span>];
0073     eval(updstr);
0074     
0075     <span class="comment">% update the data inside the GUI</span>
0076     setappdata(fig,<span class="string">'data'</span>,data);
0077     
0078     <span class="comment">% depending on the particular edit field, further actions are</span>
0079     <span class="comment">% necessary</span>
0080     <span class="keyword">switch</span> tag
0081         <span class="comment">% -----------------------------------------------------------------</span>
0082         <span class="comment">% --- BASICS ------------------------------------------------------</span>
0083         <span class="comment">% -----------------------------------------------------------------</span>
0084         <span class="keyword">case</span> <span class="string">'basic_B0'</span>
0085             <span class="comment">% new Larmor frequency due to changed B0</span>
0086             data.basic.Omega0 = <a href="../../../blochus/functions/blochsim/getOmega0.html" class="code" title="function omega0 = getOmega0(gamma,B)">getOmega0</a>(data.basic.gamma,data.basic.B0)/2/pi;
0087             <span class="comment">% update the GUI fields</span>
0088             set(gui.edit_handles.Omega0,<span class="string">'String'</span>,sprintf(<span class="string">'%7.2f'</span>,data.basic.Omega0));
0089             setappdata(fig,<span class="string">'data'</span>,data);
0090             <span class="comment">% if &quot;Pulse&quot; is activated, update the pulse as if the</span>
0091             <span class="comment">% pulse length (or number of periods) would have been changed</span>
0092             <span class="comment">% manually</span>
0093             <span class="keyword">if</span> get(gui.check_handles.Pulse,<span class="string">'Value'</span>) == 1
0094                 <a href="onEditValue.html" class="code" title="function onEditValue(src,~)">onEditValue</a>(gui.edit_handles.PulseTtau);
0095                 data = getappdata(fig,<span class="string">'data'</span>);
0096             <span class="keyword">end</span>
0097             <span class="comment">% if &quot;PrePol&quot; is activated and the active ramp is &quot;melton1995&quot;</span>
0098             <span class="comment">% update the switch-off ramp settings due to the changed Larmor</span>
0099             <span class="comment">% frequency</span>
0100             <span class="keyword">if</span> get(gui.check_handles.PrePol,<span class="string">'Value'</span>) == 1 &amp;&amp; <span class="keyword">...</span>
0101                     get(gui.popup_handles.PrePolRamp,<span class="string">'Value'</span>) == 5
0102                 setappdata(fig,<span class="string">'data'</span>,data);
0103                 <a href="../../../blochus/callbacks/popup/onPopupPrePolRamp.html" class="code" title="function onPopupPrePolRamp(src,~)">onPopupPrePolRamp</a>(gui.popup_handles.PrePolRamp);
0104                 data = getappdata(fig,<span class="string">'data'</span>);
0105             <span class="keyword">end</span>
0106             <span class="keyword">if</span> get(gui.check_handles.PrePol,<span class="string">'Value'</span>) == 1
0107                 setappdata(fig,<span class="string">'data'</span>,data);
0108                 <a href="../../../blochus/functions/interface/getRampParameters.html" class="code" title="function getRampParameters(fig)">getRampParameters</a>(fig);
0109                 data = getappdata(fig,<span class="string">'data'</span>);
0110             <span class="keyword">end</span>
0111             
0112         <span class="keyword">case</span> <span class="string">'basic_Omega0'</span>
0113             <span class="comment">% fix sign if it is wrong</span>
0114             <span class="keyword">if</span> (data.basic.gamma &gt; 0 &amp;&amp; data.basic.Omega0 &gt; 0) || <span class="keyword">...</span>
0115                     (data.basic.gamma &lt; 0 &amp;&amp; data.basic.Omega0 &lt; 0)
0116                 data.basic.Omega0 = -data.basic.Omega0;
0117             <span class="keyword">end</span>
0118             <span class="comment">% new B0 due to changed Larmor frequency</span>
0119             data.basic.B0 = <a href="../../../blochus/functions/blochsim/getB0.html" class="code" title="function B = getB0(gamma,omega0)">getB0</a>(data.basic.gamma,data.basic.Omega0*2*pi);
0120             <span class="comment">% update the GUI fields</span>
0121             set(gui.edit_handles.Omega0,<span class="string">'String'</span>,sprintf(<span class="string">'%7.2f'</span>,data.basic.Omega0));
0122             set(gui.edit_handles.B0,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4e'</span>,data.basic.B0));
0123             setappdata(fig,<span class="string">'data'</span>,data);
0124             <span class="comment">% if &quot;Pulse&quot; is activated, update the pulse as if the</span>
0125             <span class="comment">% pulse length (or number of periods) would have been changed</span>
0126             <span class="comment">% manually</span>
0127             <span class="keyword">if</span> get(gui.check_handles.Pulse,<span class="string">'Value'</span>) == 1
0128                 <a href="onEditValue.html" class="code" title="function onEditValue(src,~)">onEditValue</a>(gui.edit_handles.PulseTtau);
0129                 data = getappdata(fig,<span class="string">'data'</span>);
0130             <span class="keyword">end</span>
0131             <span class="comment">% if &quot;PrePol&quot; is activated and the active ramp is &quot;melton1995&quot;</span>
0132             <span class="comment">% update the switch-off ramp settings due to the changed Larmor</span>
0133             <span class="comment">% frequency</span>
0134             <span class="keyword">if</span> get(gui.check_handles.PrePol,<span class="string">'Value'</span>) == 1 &amp;&amp; <span class="keyword">...</span>
0135                     get(gui.popup_handles.PrePolRamp,<span class="string">'Value'</span>) == 5
0136                 setappdata(fig,<span class="string">'data'</span>,data);
0137                 <a href="../../../blochus/callbacks/popup/onPopupPrePolRamp.html" class="code" title="function onPopupPrePolRamp(src,~)">onPopupPrePolRamp</a>(gui.popup_handles.PrePolRamp);
0138                 data = getappdata(fig,<span class="string">'data'</span>);
0139             <span class="keyword">end</span>
0140             <span class="keyword">if</span> get(gui.check_handles.PrePol,<span class="string">'Value'</span>) == 1
0141                 setappdata(fig,<span class="string">'data'</span>,data);
0142                 <a href="../../../blochus/functions/interface/getRampParameters.html" class="code" title="function getRampParameters(fig)">getRampParameters</a>(fig);
0143                 data = getappdata(fig,<span class="string">'data'</span>);
0144             <span class="keyword">end</span>
0145             
0146         <span class="keyword">case</span> <span class="string">'basic_Minitx'</span>
0147             <span class="comment">% x-component of init magnetization</span>
0148             data.basic.Minit(1) = val;
0149             
0150         <span class="keyword">case</span> <span class="string">'basic_Minity'</span>
0151             <span class="comment">% y-component of init magnetization</span>
0152             data.basic.Minit(2) = val;
0153             
0154         <span class="keyword">case</span> <span class="string">'basic_Minitz'</span>
0155             <span class="comment">% z-component of init magnetization</span>
0156             data.basic.Minit(3) = val;
0157             
0158             <span class="comment">% -------------------------------------------------------------</span>
0159             <span class="comment">% --- PRE-POLARIZATION ----------------------------------------</span>
0160             <span class="comment">% -------------------------------------------------------------</span>
0161         
0162         <span class="keyword">case</span> {<span class="string">'prepol_Factor'</span>,<span class="string">'prepol_SwitchFactor'</span>}
0163             <span class="comment">% check if the ramp type is &quot;melton1995&quot;, if yes update the</span>
0164             <span class="comment">% switch-off time to maintain the same switch-off rate</span>
0165             <span class="keyword">if</span> get(gui.popup_handles.PrePolRamp,<span class="string">'Value'</span>) == 5
0166                 <span class="comment">% k / rate</span>
0167                 GAMMA = data.prepol.Factor/data.prepol.SwitchFactor;
0168                 <span class="comment">% corresponding ramp time</span>
0169                 Tramp = GAMMA/(data.basic.B0*data.basic.gamma)*1e3; <span class="comment">% [ms]</span>
0170                 data.prepol.Tramp = Tramp;
0171                 data.prepol.Tslope = Tramp;
0172                 <span class="keyword">switch</span> data.basic.type
0173                     <span class="keyword">case</span> <span class="string">'prepol'</span>
0174                         data.basic.Tsim = Tramp;
0175                         set(gui.edit_handles.Tsim,<span class="string">'String'</span>,num2str(data.basic.Tsim));
0176                     <span class="keyword">otherwise</span>
0177                         <span class="comment">% nothing to do</span>
0178                 <span class="keyword">end</span>
0179                 setappdata(fig,<span class="string">'data'</span>,data);
0180                 set(gui.edit_handles.PrePolTramp,<span class="string">'String'</span>,num2str(data.prepol.Tramp));
0181                 set(gui.edit_handles.PrePolTslope,<span class="string">'String'</span>,num2str(data.prepol.Tslope));
0182             <span class="keyword">end</span>
0183             <span class="comment">% update switch-off ramp settings</span>
0184             <a href="../../../blochus/functions/interface/getRampParameters.html" class="code" title="function getRampParameters(fig)">getRampParameters</a>(fig);
0185             data = getappdata(fig,<span class="string">'data'</span>);
0186             <a href="../../../blochus/functions/interface/plotRamp.html" class="code" title="function plotRamp(fig)">plotRamp</a>(fig);
0187             
0188         <span class="keyword">case</span> {<span class="string">'prepol_Theta'</span>,<span class="string">'prepol_Phi'</span>,<span class="string">'prepol_Tslope'</span>}
0189             <span class="comment">% update switch-off ramp settings</span>
0190             <a href="../../../blochus/functions/interface/getRampParameters.html" class="code" title="function getRampParameters(fig)">getRampParameters</a>(fig);
0191             data = getappdata(fig,<span class="string">'data'</span>);
0192             <a href="../../../blochus/functions/interface/plotRamp.html" class="code" title="function plotRamp(fig)">plotRamp</a>(fig);
0193             
0194         <span class="keyword">case</span> <span class="string">'prepol_Tramp'</span>
0195             <span class="comment">% for &quot;linear&quot; and &quot;half cosine&quot; ramp set the Tslope value,</span>
0196             <span class="comment">% which is not need here equal to Tramp</span>
0197             <span class="keyword">if</span> strcmp(data.prepol.Ramp,<span class="string">'lin'</span>) || strcmp(data.prepol.Ramp,<span class="string">'halfcos'</span>)
0198                 data.prepol.Tslope = data.prepol.Tramp;
0199                 set(gui.edit_handles.PrePolTslope,<span class="string">'String'</span>,num2str(data.prepol.Tslope));
0200             <span class="keyword">end</span>
0201             <span class="comment">% in case of pure &quot;PrePol&quot; update the total simulation time</span>
0202             <span class="keyword">switch</span> data.basic.type
0203                 <span class="keyword">case</span> <span class="string">'prepol'</span>
0204                     data.basic.Tsim = data.prepol.Tramp;
0205                     set(gui.edit_handles.Tsim,<span class="string">'String'</span>,num2str(data.basic.Tsim));
0206                 <span class="keyword">otherwise</span>
0207                     <span class="comment">% nothing to do</span>
0208             <span class="keyword">end</span>
0209             setappdata(fig,<span class="string">'data'</span>,data);
0210             <span class="comment">% update switch-off ramp settings</span>
0211             <a href="../../../blochus/functions/interface/getRampParameters.html" class="code" title="function getRampParameters(fig)">getRampParameters</a>(fig);
0212             data = getappdata(fig,<span class="string">'data'</span>);
0213             <a href="../../../blochus/functions/interface/plotRamp.html" class="code" title="function plotRamp(fig)">plotRamp</a>(fig);
0214             
0215             <span class="comment">% -------------------------------------------------------------</span>
0216             <span class="comment">% --- PULSE ---------------------------------------------------</span>
0217             <span class="comment">% -------------------------------------------------------------</span>
0218         
0219         <span class="keyword">case</span> <span class="string">'pulse_B1Factor'</span>
0220             <span class="comment">% if the pulse amplitude changes some settings have to be</span>
0221             <span class="comment">% adjusted, depending on the chosen pulse type</span>
0222             <span class="keyword">switch</span> data.pulse.Type
0223                 <span class="keyword">case</span> {<span class="string">'pi_half'</span>,<span class="string">'pi'</span>}
0224                     <span class="keyword">switch</span> data.pulse.Type
0225                         <span class="keyword">case</span> <span class="string">'pi_half'</span>
0226                             <span class="comment">% in case of &quot;pi_half&quot; the pulse length gets updated</span>
0227                             data.pulse.Ttau = abs(1e3*(pi/2/(data.basic.gamma*<span class="keyword">...</span>
0228                                 data.basic.B0*data.pulse.B1Factor)));
0229                         <span class="keyword">case</span> <span class="string">'pi'</span>
0230                             <span class="comment">% in case of &quot;pi&quot; the pulse length gets updated</span>
0231                             data.pulse.Ttau = abs(1e3*(pi/(data.basic.gamma*<span class="keyword">...</span>
0232                                 data.basic.B0*data.pulse.B1Factor)));
0233                     <span class="keyword">end</span>
0234                     set(gui.edit_handles.PulseTtau,<span class="string">'String'</span>,num2str(data.pulse.Ttau));
0235                     <span class="comment">% in case of pure &quot;Pulse&quot; update the total simulation time</span>
0236                     <span class="keyword">switch</span> data.basic.type
0237                         <span class="keyword">case</span> <span class="string">'pulse'</span>
0238                             data.basic.Tsim = data.pulse.Ttau;
0239                             set(gui.edit_handles.Tsim,<span class="string">'String'</span>,num2str(data.basic.Tsim));
0240                         <span class="keyword">otherwise</span>
0241                             <span class="comment">% nothing to do</span>
0242                     <span class="keyword">end</span>
0243                     setappdata(fig,<span class="string">'data'</span>,data);
0244                     <span class="comment">% update pulse settings</span>
0245                     <a href="../../../blochus/functions/interface/getPulseParameters.html" class="code" title="function getPulseParameters(fig)">getPulseParameters</a>(fig);
0246                     data = getappdata(fig,<span class="string">'data'</span>);
0247                     <a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>(fig);
0248                     
0249                 <span class="keyword">otherwise</span>
0250                     <span class="comment">% update pulse settings</span>
0251                     <a href="../../../blochus/functions/interface/getPulseParameters.html" class="code" title="function getPulseParameters(fig)">getPulseParameters</a>(fig);
0252                     data = getappdata(fig,<span class="string">'data'</span>);
0253                     <a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>(fig);
0254             <span class="keyword">end</span>
0255             
0256         <span class="keyword">case</span> <span class="string">'pulse_Ttau'</span>
0257             <span class="comment">% if the pulse length changes some settings have to be</span>
0258             <span class="comment">% adjusted, depending on the chosen pulse type</span>
0259             <span class="keyword">switch</span> data.pulse.Type
0260                 <span class="keyword">case</span> {<span class="string">'pi_half'</span>,<span class="string">'pi'</span>}
0261                     <span class="keyword">switch</span> data.pulse.Type
0262                         <span class="keyword">case</span> <span class="string">'pi_half'</span>
0263                             <span class="comment">% in case of &quot;pi_half&quot; the pulse amplitude gets updated</span>
0264                             data.pulse.B1Factor = abs(1e3*(pi/2/(data.basic.gamma*<span class="keyword">...</span>
0265                                 data.basic.B0*data.pulse.Ttau)));
0266                         <span class="keyword">case</span> <span class="string">'pi'</span>
0267                             <span class="comment">% in case of &quot;pi&quot; the pulse amplitude gets updated</span>
0268                             data.pulse.B1Factor = abs(1e3*(pi/(data.basic.gamma*<span class="keyword">...</span>
0269                                 data.basic.B0*data.pulse.Ttau)));
0270                     <span class="keyword">end</span>
0271                     set(gui.edit_handles.PulseB1Factor,<span class="string">'String'</span>,num2str(data.pulse.B1Factor));
0272                     <span class="comment">% in case of pure &quot;Pulse&quot; update the total simulation time</span>
0273                     <span class="keyword">switch</span> data.basic.type
0274                         <span class="keyword">case</span> <span class="string">'pulse'</span>
0275                             data.basic.Tsim = data.pulse.Ttau;
0276                             set(gui.edit_handles.Tsim,<span class="string">'String'</span>,num2str(data.basic.Tsim));
0277                         <span class="keyword">otherwise</span>
0278                             <span class="comment">% nothing to do</span>
0279                     <span class="keyword">end</span>
0280                     setappdata(fig,<span class="string">'data'</span>,data);
0281                     <span class="comment">% update pulse settings</span>
0282                     <a href="../../../blochus/functions/interface/getPulseParameters.html" class="code" title="function getPulseParameters(fig)">getPulseParameters</a>(fig);
0283                     data = getappdata(fig,<span class="string">'data'</span>);
0284                     <a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>(fig);
0285                     
0286                 <span class="keyword">case</span> <span class="string">'MIDI_OR'</span>
0287                     <span class="comment">% in case of &quot;MIDI_OR&quot; the PulseTtau-field holds the</span>
0288                     <span class="comment">% number of periods</span>
0289                     data.pulse.MIDINP = val;
0290                     <span class="comment">% update pulse length</span>
0291                     data.pulse.Ttau = abs(data.pulse.MIDINP/data.basic.Omega0)*1e3;
0292                     <span class="comment">% update pulse amplitude to pi/2 value</span>
0293                     data.pulse.B1Factor = abs(1e3*(pi/2/(data.basic.gamma*<span class="keyword">...</span>
0294                         data.basic.B0*data.pulse.Ttau)));
0295                     set(gui.edit_handles.PulseB1Factor,<span class="string">'String'</span>,num2str(data.pulse.B1Factor));
0296                     <span class="comment">% in case of pure &quot;Pulse&quot; update the total simulation time</span>
0297                     <span class="keyword">switch</span> data.basic.type
0298                         <span class="keyword">case</span> <span class="string">'pulse'</span>
0299                             data.basic.Tsim = data.pulse.Ttau;
0300                             set(gui.edit_handles.Tsim,<span class="string">'String'</span>,num2str(data.basic.Tsim));
0301                         <span class="keyword">otherwise</span>
0302                             <span class="comment">% nothing to do</span>
0303                     <span class="keyword">end</span>
0304                     setappdata(fig,<span class="string">'data'</span>,data);
0305                     <span class="comment">% update pulse settings</span>
0306                     <a href="../../../blochus/functions/interface/getPulseParameters.html" class="code" title="function getPulseParameters(fig)">getPulseParameters</a>(fig);
0307                     data = getappdata(fig,<span class="string">'data'</span>);
0308                     <a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>(fig);
0309                     
0310                 <span class="keyword">case</span> <span class="string">'MIDI_AP'</span>
0311                     <span class="comment">% in case of &quot;MIDI_AP&quot; the PulseTtau-field holds the</span>
0312                     <span class="comment">% number of periods</span>
0313                     data.pulse.MIDINP = val;
0314                     <span class="comment">% update pulse length assuming a constant frequency</span>
0315                     data.pulse.Ttau = abs(data.pulse.MIDINP/data.basic.Omega0)*1e3;
0316                     <span class="comment">% now calculate the actual pulse settings</span>
0317                     setappdata(fig,<span class="string">'data'</span>,data);
0318                     <a href="../../../blochus/functions/interface/getPulseParameters.html" class="code" title="function getPulseParameters(fig)">getPulseParameters</a>(fig);
0319                     data = getappdata(fig,<span class="string">'data'</span>);
0320                     <span class="comment">% adjust the pulse length to the actual value</span>
0321                     data.pulse.Ttau = data.pulse_MIDI.t(end)*1e3;
0322                     <span class="comment">% in case of pure &quot;Pulse&quot; update the total simulation time</span>
0323                     <span class="keyword">switch</span> data.basic.type
0324                         <span class="keyword">case</span> <span class="string">'pulse'</span>
0325                             data.basic.Tsim = data.pulse.Ttau;
0326                             set(gui.edit_handles.Tsim,<span class="string">'String'</span>,num2str(data.basic.Tsim));
0327                         <span class="keyword">otherwise</span>
0328                             <span class="comment">% nothing to do</span>
0329                     <span class="keyword">end</span>
0330                     setappdata(fig,<span class="string">'data'</span>,data);
0331                     <span class="comment">% update pulse plot</span>
0332                     <a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>(fig);
0333                     
0334                 <span class="keyword">otherwise</span>
0335                     <span class="comment">% for all other pulse types (&quot;free&quot; &amp; &quot;AHP&quot;)</span>
0336                     <span class="comment">% in case of pure &quot;Pulse&quot; update the total simulation time</span>
0337                     <span class="keyword">switch</span> data.basic.type
0338                         <span class="keyword">case</span> <span class="string">'pulse'</span>
0339                             data.basic.Tsim = data.pulse.Ttau;
0340                             set(gui.edit_handles.Tsim,<span class="string">'String'</span>,num2str(data.basic.Tsim));
0341                         <span class="keyword">otherwise</span>
0342                             <span class="comment">% nothing to do</span>
0343                     <span class="keyword">end</span>
0344                     <span class="comment">% update GUI data</span>
0345                     setappdata(fig,<span class="string">'data'</span>,data);
0346                     <span class="comment">% update pulse settings</span>
0347                     <a href="../../../blochus/functions/interface/getPulseParameters.html" class="code" title="function getPulseParameters(fig)">getPulseParameters</a>(fig);
0348                     data = getappdata(fig,<span class="string">'data'</span>);
0349                     <a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>(fig);
0350             <span class="keyword">end</span>
0351             
0352         <span class="keyword">otherwise</span>
0353             <span class="keyword">switch</span> data.basic.type
0354                 <span class="comment">% update all changes related to the pulse modulation</span>
0355                 <span class="keyword">case</span> {<span class="string">'pulse'</span>,<span class="string">'prepolpulse'</span>}
0356                     setappdata(fig,<span class="string">'data'</span>,data);
0357                     <a href="../../../blochus/functions/interface/getPulseParameters.html" class="code" title="function getPulseParameters(fig)">getPulseParameters</a>(fig);
0358                     data = getappdata(fig,<span class="string">'data'</span>);
0359                     <a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>(fig);
0360                     
0361                 <span class="keyword">otherwise</span>
0362                     <span class="comment">% because the pulse data changed, deactivate the</span>
0363                     <span class="comment">% &quot;Animate&quot; button</span>
0364                     set(gui.push_handles.Animate,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0365             <span class="keyword">end</span>
0366     <span class="keyword">end</span>
0367     
0368     <span class="comment">% update GUI data</span>
0369     setappdata(fig,<span class="string">'data'</span>,data);
0370 <span class="keyword">else</span>
0371     warndlg({<span class="string">'onEditValue:'</span>,<span class="string">'There is no figure with the BLOCHUS Tag open.'</span>},<span class="keyword">...</span>
0372         <span class="string">'BLOCHUS error'</span>);
0373 <span class="keyword">end</span>
0374 
0375 <span class="keyword">end</span>
0376 
0377 <span class="comment">%% helper function to create the update string</span>
0378 <a name="_sub1" href="#_subfunctions" class="code">function out = createDataString(tag)</a>
0379 <span class="comment">% find the underscore</span>
0380 ind = strfind(tag,<span class="string">'_'</span>);
0381 <span class="comment">% the panel name is before the underscore</span>
0382 out.panel = tag(1:ind(1)-1);
0383 <span class="comment">% the field name afterwards</span>
0384 out.field = tag(ind(1)+1:end);
0385 <span class="comment">% replace the underscore with a dot</span>
0386 tag(ind) = <span class="string">'.'</span>;
0387 <span class="comment">% create the update string</span>
0388 out.updstr = [<span class="string">'data.'</span>,tag];
0389 
0390 <span class="keyword">end</span>
0391 
0392 <span class="comment">%------------- END OF CODE --------------</span>
0393 
0394 <span class="comment">%% License:</span>
0395 <span class="comment">% GNU GPLv3</span>
0396 <span class="comment">%</span>
0397 <span class="comment">% BLOCHUS</span>
0398 <span class="comment">% Copyright (C) 2019 Thomas Hiller</span>
0399 <span class="comment">%</span>
0400 <span class="comment">% This program is free software: you can redistribute it and/or modify</span>
0401 <span class="comment">% it under the terms of the GNU General Public License as published by</span>
0402 <span class="comment">% the Free Software Foundation, either version 3 of the License, or</span>
0403 <span class="comment">% (at your option) any later version.</span>
0404 <span class="comment">%</span>
0405 <span class="comment">% This program is distributed in the hope that it will be useful,</span>
0406 <span class="comment">% but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0407 <span class="comment">% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0408 <span class="comment">% GNU General Public License for more details.</span>
0409 <span class="comment">%</span>
0410 <span class="comment">% You should have received a copy of the GNU General Public License</span>
0411 <span class="comment">% along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>