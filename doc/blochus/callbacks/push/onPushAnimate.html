<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of onPushAnimate</title>
  <meta name="keywords" content="onPushAnimate">
  <meta name="description" content=" animates the results of the latest simulation">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # blochus --><!-- # callbacks --><!-- menu.html push -->
<h1>onPushAnimate
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> animates the results of the latest simulation</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function onPushAnimate(src,~) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">onPushAnimate animates the results of the latest simulation

 Syntax:
       onPushAnimate(src)

 Inputs:
       src - handle of the calling object

 Outputs:
       none

 Example:
       onPushAnimate(src)

 Other m-files required:
       clearSingleAxis
       plotBSphere
       plotPulse
       plotRamp
       plotResults

 Subfunctions:
       none

 MAT-files required:
       none

 See also: BLOCHUS
 Author: Thomas Hiller
 email: thomas.hiller[at]leibniz-liag.de
 License: GNU GPLv3 (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../blochus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>	 clears an individual axis</li><li><a href="../../../blochus/functions/interface/plotBSphere.html" class="code" title="function bsh = plotBSphere(dlat,dlong,ax,varargin)">plotBSphere</a>	 plots a (Bloch)-Sphere (basically a unit sphere) with</li><li><a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>	 plots different pulse parameter</li><li><a href="../../../blochus/functions/interface/plotRamp.html" class="code" title="function plotRamp(fig)">plotRamp</a>	 plots different pre-polarization switch-off ramp parameter</li><li><a href="../../../blochus/functions/interface/plotResults.html" class="code" title="function plotResults(fig)">plotResults</a>	 plots results depending on the chosen settings</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../blochus/BLOCHUS/BLOCHUS_createPanelControl.html" class="code" title="function [gui,myui] = BLOCHUS_createPanelControl(gui,myui)">BLOCHUS_createPanelControl</a>	 creates "Control" panel</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function onPushAnimate(src,~)</a>
0002 <span class="comment">%onPushAnimate animates the results of the latest simulation</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%       onPushAnimate(src)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%       src - handle of the calling object</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Outputs:</span>
0011 <span class="comment">%       none</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Example:</span>
0014 <span class="comment">%       onPushAnimate(src)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Other m-files required:</span>
0017 <span class="comment">%       clearSingleAxis</span>
0018 <span class="comment">%       plotBSphere</span>
0019 <span class="comment">%       plotPulse</span>
0020 <span class="comment">%       plotRamp</span>
0021 <span class="comment">%       plotResults</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Subfunctions:</span>
0024 <span class="comment">%       none</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% MAT-files required:</span>
0027 <span class="comment">%       none</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% See also: BLOCHUS</span>
0030 <span class="comment">% Author: Thomas Hiller</span>
0031 <span class="comment">% email: thomas.hiller[at]leibniz-liag.de</span>
0032 <span class="comment">% License: GNU GPLv3 (at end)</span>
0033 
0034 <span class="comment">%------------- BEGIN CODE --------------</span>
0035 
0036 <span class="comment">% get GUI handle</span>
0037 fig = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0038 
0039 <span class="keyword">if</span> ~isempty(fig) &amp;&amp; strcmp(get(fig,<span class="string">'Tag'</span>),<span class="string">'BLOCHUS'</span>)
0040     <span class="comment">% get GUI data</span>
0041     gui = getappdata(fig,<span class="string">'gui'</span>);
0042     data = getappdata(fig,<span class="string">'data'</span>);
0043     myui = gui.myui;
0044     
0045     <span class="comment">% change the pushbutton color to indicate that an animation is running</span>
0046     set(src,<span class="string">'BackGroundColor'</span>,<span class="string">'r'</span>);
0047     <span class="comment">% update the status info</span>
0048     set(gui.text_handles.Status,<span class="string">'String'</span>,<span class="string">'Animation running ...'</span>);
0049     pause(0.01);
0050     
0051     <span class="comment">% ask the user for the number of frames to show</span>
0052     <span class="comment">% default is 100</span>
0053     prompt = {<span class="string">'\fontsize{9} Number of frames (default is 100):'</span>};
0054     title = <span class="string">'Number of Frames'</span>;
0055     dims = [1 50];
0056     definput = {<span class="string">'100'</span>};
0057     opts.Interpreter = <span class="string">'tex'</span>;
0058     answer = inputdlg(prompt,title,dims,definput);
0059     <span class="keyword">if</span> ~isempty(answer)
0060         NoFrames = str2double(answer{1});
0061         <span class="keyword">if</span> isnan(NoFrames) || NoFrames&lt;1
0062             NoFrames = 100;
0063         <span class="keyword">end</span>
0064     <span class="keyword">else</span>
0065          NoFrames = 100;
0066     <span class="keyword">end</span>    
0067     
0068     <span class="keyword">switch</span> data.basic.type        
0069         <span class="keyword">case</span> <span class="string">'std'</span>
0070             <span class="comment">% the two important timings</span>
0071             Tsim = data.basic.Tsim;
0072             
0073             <span class="comment">% get the data to animate</span>
0074             T = data.results.basic.T.*1e3;
0075             M = data.results.basic.M;
0076             Mrot = data.results.basic.Mrot;
0077             Mxy = sqrt(M(:,1).^2+M(:,2).^2);
0078             Mamp = sqrt(M(:,1).^2+M(:,2).^2+M(:,3).^2);
0079             
0080             <span class="comment">% get the visible magnetization axis and data</span>
0081             <span class="keyword">switch</span> get(gui.panels.Plot.Mag,<span class="string">'Selection'</span>)
0082                 <span class="keyword">case</span> 1
0083                     ax1 = gui.axes_handles.MagL;
0084                     M1 = M;
0085                 <span class="keyword">case</span> 2
0086                     ax1 = gui.axes_handles.MagR;
0087                     M1 = Mrot;
0088                 <span class="keyword">case</span> 3
0089                     ax1 = gui.axes_handles.MagL;
0090                     <span class="comment">% auto set FFT to lab frame</span>
0091                     set(gui.panels.Plot.Mag,<span class="string">'Selection'</span>,1)
0092             <span class="keyword">end</span>
0093             Mylim = get(ax1,<span class="string">'YLim'</span>);
0094             <span class="comment">% get the visible Bloch sphere axis and data</span>
0095             <span class="keyword">switch</span> get(gui.panels.Plot.Sphere,<span class="string">'Selection'</span>)
0096                 <span class="keyword">case</span> 1
0097                     ax2 = gui.axes_handles.SphereL;
0098                     M2 = M;
0099                 <span class="keyword">case</span> 2
0100                     ax2 = gui.axes_handles.SphereR;
0101                     M2 = Mrot;
0102             <span class="keyword">end</span>            
0103             Mview = get(ax2,<span class="string">'View'</span>);
0104             
0105             <span class="comment">% time vector</span>
0106             t = linspace(0,Tsim,NoFrames);
0107             
0108             <span class="comment">% initialize all axes and animation lines</span>
0109             axes(ax1);
0110             cla(ax1);
0111             hMx = animatedline(<span class="string">'Color'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0112             hMy = animatedline(<span class="string">'Color'</span>,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0113             hMz = animatedline(<span class="string">'Color'</span>,<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0114             hMxy = animatedline(<span class="string">'Color'</span>,<span class="string">'m'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0115             hMn = animatedline(<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="string">'Parent'</span>,ax1);
0116             set(get(ax1,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0117             set(get(ax1,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'magnetization M'</span>);
0118             grid(ax1,<span class="string">'on'</span>);
0119             set(ax1,<span class="string">'FontSize'</span>,myui.axfontsize);
0120             
0121             axes(ax2);
0122             cla(ax2);
0123             hold(ax2,<span class="string">'on'</span>);
0124             <a href="../../../blochus/functions/interface/plotBSphere.html" class="code" title="function bsh = plotBSphere(dlat,dlong,ax,varargin)">plotBSphere</a>(18,18,ax2);
0125             h3dM = animatedline(<span class="string">'Color'</span>,myui.color.basic,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0126             
0127             <span class="comment">% loop over the data</span>
0128             <span class="keyword">for</span> nf = 1:NoFrames-1
0129                 
0130                 <span class="comment">% get the index vector of the current data to plot</span>
0131                 indt = T&gt;=t(nf) &amp; T&lt;t(nf+1);
0132                 <span class="comment">% current time vector</span>
0133                 x = T(indt);
0134                 
0135                 <span class="comment">% get data to plot for M</span>
0136                 <span class="comment">% left panel</span>
0137                 yMx = M1(indt,1);
0138                 yMy = M1(indt,2);
0139                 yMz = M1(indt,3);
0140                 yMxy = Mxy(indt,1);
0141                 yMn = Mamp(indt,1);
0142 
0143                 <span class="comment">% plot data into axes</span>
0144                 addpoints(hMx,x,yMx);
0145                 addpoints(hMy,x,yMy);
0146                 addpoints(hMz,x,yMz);
0147                 addpoints(hMxy,x,yMxy);
0148                 addpoints(hMn,x,yMn);
0149                 
0150                 legend(ax1,<span class="string">'x'</span>,<span class="string">'M'</span>,<span class="string">'z'</span>,<span class="string">'Location'</span>,<span class="string">'SouthWest'</span>);
0151                 set(ax1,<span class="string">'XLim'</span>,[min(T) max(T)],<span class="string">'YLim'</span>,Mylim);
0152                 lh = legend(ax1,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'|xy|'</span>,<span class="string">'|M|'</span>,<span class="string">'Location'</span>,<span class="string">'SouthWest'</span>);
0153                 
0154                 <span class="comment">% Bloch sphere</span>
0155                 yMxx = M2(indt,1);
0156                 yMyy = M2(indt,2);
0157                 yMzz = M2(indt,3);
0158                 
0159                 addpoints(h3dM,yMxx,yMyy,yMzz);
0160                 view(ax2,Mview);
0161                 set(ax2,<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'XColor'</span>,<span class="string">'none'</span>,<span class="string">'YColor'</span>,<span class="string">'none'</span>,<span class="string">'ZColor'</span>,<span class="string">'none'</span>);
0162                 axis(ax2,<span class="string">'equal'</span>);
0163                 axis(ax2,<span class="string">'tight'</span>);
0164                 
0165                 <span class="comment">% pause a bit to show the animation</span>
0166                 <span class="comment">% drawnow limitrate works also but is a bit too fast</span>
0167                 pause(1/24);
0168                 <span class="comment">% drawnow limitrate;</span>
0169             <span class="keyword">end</span>
0170             hold(ax1,<span class="string">'off'</span>);
0171             hold(ax2,<span class="string">'off'</span>);
0172             
0173         <span class="keyword">case</span> <span class="string">'prepol'</span>
0174             <span class="comment">% get the results data</span>
0175             basic = data.results.basic;
0176             prepol = data.results.prepol;
0177             
0178             <span class="comment">% the two important timings</span>
0179             Tsim = data.basic.Tsim;
0180             Tramp = data.prepol.Tramp;
0181             
0182             <span class="comment">% get the data to animate</span>
0183             T1 = basic.T.*1e3;
0184             M = basic.M;
0185             Mxy = sqrt(M(:,1).^2+M(:,2).^2);
0186             Mamp = sqrt(M(:,1).^2+M(:,2).^2+M(:,3).^2);
0187             M = M./data.basic.B0;
0188             Mxy = Mxy./data.basic.B0;
0189             Mamp = Mamp./data.basic.B0;
0190             <span class="comment">% switch-off B-field trajectory</span>
0191             Bamp = sqrt(prepol.Beff(:,1).^2+prepol.Beff(:,2).^2+prepol.Beff(:,3).^2);
0192             Beffn = prepol.Beff./Bamp;
0193             
0194             <span class="comment">% set the M axes handles</span>
0195             set(gui.panels.Plot.Mag,<span class="string">'Selection'</span>,1);
0196             set(gui.panels.Plot.Sphere,<span class="string">'Selection'</span>,1);
0197             ax1 = gui.axes_handles.MagL;
0198             ax2 = gui.axes_handles.SphereL;
0199             Mylim = get(ax1,<span class="string">'YLim'</span>);
0200             Mview = get(ax2,<span class="string">'View'</span>);
0201             
0202             <span class="comment">% get the visible PrePol Ramp parameter axes and data</span>
0203             <span class="comment">% only this needs to be shown</span>
0204             T2 = prepol.t.*1e3;
0205             <span class="keyword">switch</span> get(gui.panels.Plot.PrePol,<span class="string">'Selection'</span>)
0206                 <span class="keyword">case</span> 1
0207                     ax3 = gui.axes_handles.Bpre;
0208                     Bval = prepol.Bp./data.basic.B0;
0209                     ylab = <span class="string">'Bp [B0]'</span>;
0210                 <span class="keyword">case</span> 2
0211                     ax3 = gui.axes_handles.alpha;
0212                     Bval = rad2deg(prepol.alpha);
0213                     ylab = <span class="string">'\alpha [deg]'</span>;
0214                 <span class="keyword">case</span> 3
0215                     ax3 = gui.axes_handles.dadt;
0216                     Bval = prepol.dadt;
0217                     ylab = <span class="string">'d\alpha / dt'</span>;
0218                 <span class="keyword">case</span> 4
0219                     ax3 = gui.axes_handles.wda;
0220                     Bval = prepol.dadt./prepol.omega(1:numel(prepol.dadt));
0221                     ylab = <span class="string">'(d\alpha/dt) / \gammaB'</span>;
0222             <span class="keyword">end</span>
0223             Bylim = get(ax3,<span class="string">'YLim'</span>);
0224 
0225             <span class="comment">% time vector</span>
0226             dt = Tsim(end)/NoFrames;
0227             <span class="comment">% including all relevant time markers</span>
0228             t = unique([0:dt:Tsim Tramp]);
0229             <span class="comment">% adapt the number frames</span>
0230             NoFrames = numel(t);
0231             
0232             <span class="comment">% initialize all axes and animation lines</span>
0233             axes(ax1);
0234             cla(ax1);
0235             hMx = animatedline(<span class="string">'Color'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0236             hMy = animatedline(<span class="string">'Color'</span>,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0237             hMz = animatedline(<span class="string">'Color'</span>,<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0238             hMxy = animatedline(<span class="string">'Color'</span>,<span class="string">'m'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0239             hMn = animatedline(<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="string">'Parent'</span>,ax1);
0240             set(get(ax1,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0241             set(get(ax1,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'magnetization M'</span>);
0242             grid(ax1,<span class="string">'on'</span>);
0243             set(ax1,<span class="string">'FontSize'</span>,myui.axfontsize);
0244             
0245             axes(ax2);
0246             cla(ax2);
0247             hold(ax2,<span class="string">'on'</span>);
0248             <a href="../../../blochus/functions/interface/plotBSphere.html" class="code" title="function bsh = plotBSphere(dlat,dlong,ax,varargin)">plotBSphere</a>(18,18,ax2);
0249             h3dMa = animatedline(<span class="string">'Color'</span>,myui.color.prepol,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0250             h3dMb = animatedline(<span class="string">'Color'</span>,myui.color.basic,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0251             h3dB = animatedline(<span class="string">'Color'</span>,myui.color.prepolB,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0252             
0253             axes(ax3);
0254             <a href="../../../blochus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(ax3);
0255             hB = animatedline(<span class="string">'Color'</span>,myui.color.prepolB,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax3);
0256             set(get(ax3,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0257             set(get(ax3,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,ylab);
0258             grid(ax3,<span class="string">'on'</span>);
0259             set(ax3,<span class="string">'FontSize'</span>,myui.axfontsize);
0260             
0261             <span class="comment">% loop over the data</span>
0262             <span class="keyword">for</span> nf = 1:NoFrames-1
0263                 <span class="comment">% get the index vector of the current data to plot</span>
0264                 indt = T1&gt;=t(nf) &amp; T1&lt;t(nf+1);
0265                 <span class="comment">% get the current time vector for M</span>
0266                 x1 = T1(indt);
0267                 <span class="comment">% get data to plot for M</span>
0268                 yMx = M(indt,1);
0269                 yMy = M(indt,2);
0270                 yMz = M(indt,3);
0271                 yMxy = Mxy(indt,1);
0272                 yMn = Mamp(indt,1);
0273                 
0274                 <span class="comment">% plot M into lab frame axes</span>
0275                 addpoints(hMx,x1,yMx);
0276                 addpoints(hMy,x1,yMy);
0277                 addpoints(hMz,x1,yMz);
0278                 addpoints(hMxy,x1,yMxy);
0279                 addpoints(hMn,x1,yMn);
0280                 <span class="comment">% M axis settings</span>
0281                 set(ax1,<span class="string">'XLim'</span>,[min(T1) max(T1)],<span class="string">'YLim'</span>,Mylim);
0282                 lh = legend(ax1,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'|xy|'</span>,<span class="string">'|M|'</span>,<span class="string">'Location'</span>,<span class="string">'SouthWest'</span>);
0283                 
0284                 <span class="comment">% as long as we are in the &quot;ramp&quot; phase gather the data of</span>
0285                 <span class="comment">% the effective B-field to plot as a trace on the Bloch</span>
0286                 <span class="comment">% sphere and the ramp parameter that is plotted into the</span>
0287                 <span class="comment">% prepol-panel</span>
0288                 <span class="keyword">if</span> t(nf) &lt; Tramp
0289                     indt2 = T2&gt;=t(nf) &amp; T2&lt;t(nf+1);
0290                     yBx = Beffn(indt2,1);
0291                     yBy = Beffn(indt2,2);
0292                     yBz = Beffn(indt2,3);
0293                     yBramp = Bval(indt2,1);
0294                     
0295                     <span class="comment">% add the M data to the sphere (prepol color)</span>
0296                     addpoints(h3dMa,yMx./Mamp(1),yMy./Mamp(1),yMz./Mamp(1));
0297                     <span class="comment">% add the B-field trace to the sphere</span>
0298                     addpoints(h3dB,yBx,yBy,yBz);
0299                 <span class="keyword">else</span>
0300                     <span class="comment">% after the ramp is over</span>
0301                     <span class="comment">% add the M data to the sphere (basic color)</span>
0302                     addpoints(h3dMb,yMx./Mamp(1),yMy./Mamp(1),yMz./Mamp(1));
0303                 <span class="keyword">end</span>
0304                 <span class="comment">% sphere axis settings</span>
0305                 view(ax2,Mview);
0306                 set(ax2,<span class="string">'XLim'</span>,[-1.05 1.05],<span class="string">'YLim'</span>,[-1.05 1.05],<span class="string">'ZLim'</span>,[-1.05 1.05])
0307                 set(ax2,<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'XColor'</span>,<span class="string">'none'</span>,<span class="string">'YColor'</span>,<span class="string">'none'</span>,<span class="string">'ZColor'</span>,<span class="string">'none'</span>);
0308                 axis(ax2,<span class="string">'equal'</span>);
0309                 axis(ax2,<span class="string">'tight'</span>);
0310                 
0311                 <span class="comment">% plot the ramp parameter</span>
0312                 <span class="keyword">if</span> t(nf) &lt; Tramp
0313                     x2 = T2(indt2);
0314                     addpoints(hB,x2,yBramp);
0315                     set(ax3,<span class="string">'XLim'</span>,[min(T2) max(T2)],<span class="string">'YLim'</span>,Bylim);
0316                 <span class="keyword">end</span>
0317                 
0318                 <span class="comment">% pause a bit to show the animation</span>
0319                 <span class="comment">% drawnow limitrate works also but is a bit too fast</span>
0320                 pause(1/24);
0321                 <span class="comment">% drawnow limitrate;</span>
0322                 
0323             <span class="keyword">end</span>
0324             hold(ax1,<span class="string">'off'</span>);
0325             hold(ax2,<span class="string">'off'</span>);
0326             hold(ax3,<span class="string">'off'</span>);
0327             
0328             <span class="comment">% show the Ramp parameter again</span>
0329             <a href="../../../blochus/functions/interface/plotRamp.html" class="code" title="function plotRamp(fig)">plotRamp</a>(fig);
0330             
0331         <span class="keyword">case</span> <span class="string">'pulse'</span>
0332             <span class="comment">% get the results data</span>
0333             basic = data.results.basic;
0334             pulse = data.results.pulse;
0335             
0336             <span class="comment">% the two important timings</span>
0337             Tsim = data.basic.Tsim;
0338             Ttau = data.pulse.Ttau;
0339             
0340             <span class="comment">% get the data to animate</span>
0341             T1 = basic.T.*1e3;
0342             M = basic.M;
0343             Mrot = basic.Mrot;
0344             Mxy = sqrt(M(:,1).^2+M(:,2).^2);
0345             Mamp = sqrt(M(:,1).^2+M(:,2).^2+M(:,3).^2);
0346             
0347             <span class="comment">% get the visible magnetization axis and data</span>
0348             <span class="keyword">switch</span> get(gui.panels.Plot.Mag,<span class="string">'Selection'</span>)
0349                 <span class="keyword">case</span> 1
0350                     ax1 = gui.axes_handles.MagL;
0351                     M1 = M;
0352                 <span class="keyword">case</span> 2
0353                     ax1 = gui.axes_handles.MagR;
0354                     M1 = Mrot;
0355                 <span class="keyword">case</span> 3
0356                     ax1 = gui.axes_handles.MagL;
0357                     <span class="comment">% auto set FFT to lab frame</span>
0358                     set(gui.panels.Plot.Mag,<span class="string">'Selection'</span>,1)
0359             <span class="keyword">end</span>
0360             Mylim = get(ax1,<span class="string">'YLim'</span>);
0361             <span class="comment">% get the visible Bloch sphere axis and data</span>
0362             <span class="keyword">switch</span> get(gui.panels.Plot.Sphere,<span class="string">'Selection'</span>)
0363                 <span class="keyword">case</span> 1
0364                     ax2 = gui.axes_handles.SphereL;
0365                     M2 = M;
0366                 <span class="keyword">case</span> 2
0367                     ax2 = gui.axes_handles.SphereR;
0368                     M2 = Mrot;
0369             <span class="keyword">end</span>
0370             Mview = get(ax2,<span class="string">'View'</span>);
0371             
0372             <span class="comment">% get the visible Pulse parameter axes and data</span>
0373             <span class="comment">% only this needs to be shown</span>
0374             T2 = pulse.t;
0375             <span class="comment">% switch for df/I modulation axes</span>
0376             showdual = false;
0377             <span class="keyword">switch</span> get(gui.panels.Plot.Pulse,<span class="string">'Selection'</span>)
0378                 <span class="keyword">case</span> 1
0379                     ax3a = gui.axes_handles.PulseSetupF;
0380                     ax3b = gui.axes_handles.PulseSetupI;
0381                     P1 = [pulse.df pulse.I];
0382                     ylaba = <span class="string">'df [Hz]'</span>;
0383                     ylabb = <span class="string">'I [A]'</span>;
0384                     Pylima = get(ax3a,<span class="string">'YLim'</span>);
0385                     Pylimb = get(ax3b,<span class="string">'YLim'</span>);
0386                     showdual = true;
0387                 <span class="keyword">case</span> {2,3}
0388                     ax3 = gui.axes_handles.PulseB;
0389                     P1 = pulse.Bxy./data.basic.B0;
0390                     ylab = <span class="string">'B_1 [B_0]'</span>;
0391                     <span class="comment">% if FFT is visible, set axes to pulse amplitude</span>
0392                     set(gui.panels.Plot.Pulse,<span class="string">'Selection'</span>,2)
0393                     Pylim = get(ax3,<span class="string">'YLim'</span>);
0394             <span class="keyword">end</span>
0395             
0396             <span class="comment">% time vector</span>
0397             dt = Tsim(end)/NoFrames;
0398             <span class="comment">% including all relevant time markers</span>
0399             t = unique([0:dt:Tsim Ttau]);
0400             <span class="comment">% adapt the number frames</span>
0401             NoFrames = numel(t);
0402             
0403             <span class="comment">% initialize all axes and animation lines</span>
0404             axes(ax1);
0405             cla(ax1);
0406             hMx = animatedline(<span class="string">'Color'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0407             hMy = animatedline(<span class="string">'Color'</span>,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0408             hMz = animatedline(<span class="string">'Color'</span>,<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0409             hMxy = animatedline(<span class="string">'Color'</span>,<span class="string">'m'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0410             hMn = animatedline(<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="string">'Parent'</span>,ax1);
0411             set(get(ax1,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0412             set(get(ax1,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'magnetization M'</span>);
0413             grid(ax1,<span class="string">'on'</span>);
0414             set(ax1,<span class="string">'FontSize'</span>,myui.axfontsize);
0415             
0416             axes(ax2);
0417             cla(ax2);
0418             hold(ax2,<span class="string">'on'</span>);
0419             <a href="../../../blochus/functions/interface/plotBSphere.html" class="code" title="function bsh = plotBSphere(dlat,dlong,ax,varargin)">plotBSphere</a>(18,18,ax2);
0420             h3dMa = animatedline(<span class="string">'Color'</span>,myui.color.pulse,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0421             h3dMb = animatedline(<span class="string">'Color'</span>,myui.color.basic,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0422             
0423             <span class="keyword">if</span> showdual
0424                 <a href="../../../blochus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(ax3a);
0425                 hPx = animatedline(<span class="string">'Color'</span>,myui.color.pulse,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax3a);
0426                 set(get(ax3a,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0427                 set(get(ax3a,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,ylaba);
0428                 grid(ax3a,<span class="string">'on'</span>);
0429                 set(ax3a,<span class="string">'FontSize'</span>,myui.axfontsize);
0430                 
0431                 <a href="../../../blochus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(ax3b);
0432                 hPy = animatedline(<span class="string">'Color'</span>,myui.color.pulse,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax3b);
0433                 set(get(ax3b,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0434                 set(get(ax3b,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,ylabb);
0435                 grid(ax3b,<span class="string">'on'</span>);
0436                 set(ax3b,<span class="string">'FontSize'</span>,myui.axfontsize);
0437             <span class="keyword">else</span>
0438                 <a href="../../../blochus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(ax3);
0439                 hPx = animatedline(<span class="string">'Color'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax3);
0440                 hPy = animatedline(<span class="string">'Color'</span>,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax3);
0441                 set(get(ax3,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0442                 set(get(ax3,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,ylab);
0443                 grid(ax3,<span class="string">'on'</span>);
0444                 set(ax3,<span class="string">'FontSize'</span>,myui.axfontsize);
0445             <span class="keyword">end</span>
0446             
0447             <span class="comment">% loop over the data</span>
0448             <span class="keyword">for</span> nf = 1:NoFrames-1
0449                 <span class="comment">% get the index vector of the current data to plot</span>
0450                 indt = T1&gt;=t(nf) &amp; T1&lt;t(nf+1);
0451                 <span class="comment">% get the current time vector for M</span>
0452                 x1 = T1(indt);
0453                 <span class="comment">% get data to plot for M</span>
0454                 yMx = M1(indt,1);
0455                 yMy = M1(indt,2);
0456                 yMz = M1(indt,3);
0457                 yMxx = M2(indt,1);
0458                 yMyy = M2(indt,2);
0459                 yMzz = M2(indt,3);
0460                 yMxy = Mxy(indt,1);
0461                 yMn = Mamp(indt,1);
0462                 
0463                 <span class="comment">% plot M into lab frame axes</span>
0464                 addpoints(hMx,x1,yMx);
0465                 addpoints(hMy,x1,yMy);
0466                 addpoints(hMz,x1,yMz);
0467                 addpoints(hMxy,x1,yMxy);
0468                 addpoints(hMn,x1,yMn);
0469                 <span class="comment">% M axis settings</span>
0470                 set(ax1,<span class="string">'XLim'</span>,[min(T1) max(T1)],<span class="string">'YLim'</span>,Mylim);
0471                 lh = legend(ax1,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'|xy|'</span>,<span class="string">'|M|'</span>,<span class="string">'Location'</span>,<span class="string">'SouthWest'</span>);
0472                 
0473                 <span class="comment">% as long as we are in the &quot;pulse&quot; phase</span>
0474                 <span class="keyword">if</span> t(nf) &lt; Ttau
0475                     <span class="comment">% add the M data to the sphere (pulse color)</span>
0476                     addpoints(h3dMa,yMxx,yMyy,yMzz);
0477                 <span class="keyword">else</span>
0478                     <span class="comment">% after the ramp is over</span>
0479                     <span class="comment">% add the M data to the sphere (basic color)</span>
0480                     addpoints(h3dMb,yMxx,yMyy,yMzz);
0481                 <span class="keyword">end</span>
0482                 <span class="comment">% sphere axis settings</span>
0483                 view(ax2,Mview);
0484                 set(ax2,<span class="string">'XLim'</span>,[-1.05 1.05],<span class="string">'YLim'</span>,[-1.05 1.05],<span class="string">'ZLim'</span>,[-1.05 1.05])
0485                 set(ax2,<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'XColor'</span>,<span class="string">'none'</span>,<span class="string">'YColor'</span>,<span class="string">'none'</span>,<span class="string">'ZColor'</span>,<span class="string">'none'</span>);
0486                 axis(ax2,<span class="string">'equal'</span>);
0487                 axis(ax2,<span class="string">'tight'</span>);
0488                 
0489                 <span class="comment">% plot the Pulse parameter</span>
0490                 <span class="keyword">if</span> t(nf) &lt; Ttau
0491                     indt2 = T2&gt;=t(nf) &amp; T2&lt;t(nf+1); <span class="comment">% t2?</span>
0492                     x2 = T2(indt2);
0493                     yBx = P1(indt2,1);
0494                     yBy = P1(indt2,2);
0495                     
0496                     addpoints(hPx,x2,yBx);
0497                     addpoints(hPy,x2,yBy);
0498                     <span class="keyword">if</span> showdual
0499                         set(ax3a,<span class="string">'XLim'</span>,[min(T2) max(T2)],<span class="string">'YLim'</span>,Pylima);
0500                         lh = legend(ax3a,<span class="string">'df mod.'</span>,<span class="string">'Location'</span>,<span class="string">'SouthEast'</span>);
0501                         
0502                         set(ax3b,<span class="string">'XLim'</span>,[min(T2) max(T2)],<span class="string">'YLim'</span>,Pylimb);
0503                         lh = legend(ax3b,<span class="string">'I mod.'</span>,<span class="string">'Location'</span>,<span class="string">'SouthEast'</span>);
0504                     <span class="keyword">else</span>
0505                         set(ax3,<span class="string">'XLim'</span>,[min(T2) max(T2)],<span class="string">'YLim'</span>,Pylim);
0506                         lh = legend(ax3,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'Location'</span>,<span class="string">'SouthWest'</span>);
0507                     <span class="keyword">end</span>
0508                 <span class="keyword">end</span>
0509                 
0510                 <span class="comment">% pause a bit to show the animation</span>
0511                 <span class="comment">% drawnow limitrate works also but is a bit too fast</span>
0512                 pause(1/24);
0513                 <span class="comment">% drawnow limitrate;</span>
0514                 
0515             <span class="keyword">end</span>
0516             hold(ax1,<span class="string">'off'</span>);
0517             hold(ax2,<span class="string">'off'</span>);
0518             <span class="keyword">if</span> showdual
0519                 hold(ax3a,<span class="string">'off'</span>);
0520                 hold(ax3b,<span class="string">'off'</span>);
0521             <span class="keyword">else</span>
0522                 hold(ax3,<span class="string">'off'</span>);
0523             <span class="keyword">end</span>
0524             <span class="comment">% show the Pulse parameter again</span>
0525             <a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>(fig);
0526             
0527         <span class="keyword">case</span> <span class="string">'prepolpulse'</span>
0528             <span class="comment">% get the results data</span>
0529             basic = data.results.basic;
0530             prepol = data.results.prepol;
0531             pulse = data.results.pulse;
0532             
0533             <span class="comment">% the important timings</span>
0534             Tsim = data.basic.Tsim;
0535             Tramp = data.prepol.Tramp;
0536             Ttau = data.pulse.Ttau;
0537             Twait = data.pulse.Twait;
0538             Trelax = Tsim-Tramp-Twait-Ttau;
0539             
0540             <span class="comment">% get the data to animate</span>
0541             T1 = basic.T.*1e3;
0542             M = basic.M;
0543             Mrot = basic.Mrot;
0544             Mxy = sqrt(M(:,1).^2+M(:,2).^2);
0545             Mamp = sqrt(M(:,1).^2+M(:,2).^2+M(:,3).^2);
0546             <span class="comment">% normalize the magnetization</span>
0547             M = M./data.basic.B0;
0548             Mrot = Mrot./data.basic.B0;
0549             Mxy = Mxy./data.basic.B0;
0550             Mamp = Mamp./data.basic.B0;
0551             <span class="comment">% switch-off B-field trajectory</span>
0552             Bamp = sqrt(prepol.Beff(:,1).^2+prepol.Beff(:,2).^2+prepol.Beff(:,3).^2);
0553             Beffn = prepol.Beff./Bamp;
0554             
0555             <span class="comment">% get the visible magnetization axis and data</span>
0556             <span class="keyword">switch</span> get(gui.panels.Plot.Mag,<span class="string">'Selection'</span>)
0557                 <span class="keyword">case</span> 1
0558                     ax1 = gui.axes_handles.MagL;
0559                     M1 = M;
0560                 <span class="keyword">case</span> 2
0561                     ax1 = gui.axes_handles.MagR;
0562                     M1 = Mrot;
0563                 <span class="keyword">case</span> 3
0564                     ax1 = gui.axes_handles.MagL;
0565                     <span class="comment">% auto set FFT to lab frame</span>
0566                     set(gui.panels.Plot.Mag,<span class="string">'Selection'</span>,1)
0567             <span class="keyword">end</span>
0568             Mylim = get(ax1,<span class="string">'YLim'</span>);            
0569             <span class="comment">% get the visible Bloch sphere axis and data</span>
0570             <span class="keyword">switch</span> get(gui.panels.Plot.Sphere,<span class="string">'Selection'</span>)
0571                 <span class="keyword">case</span> 1
0572                     ax2 = gui.axes_handles.SphereL;
0573                     M2 = M;
0574                 <span class="keyword">case</span> 2
0575                     ax2 = gui.axes_handles.SphereR;
0576                     M2 = Mrot;
0577             <span class="keyword">end</span>
0578             Mview = get(ax2,<span class="string">'View'</span>);
0579             
0580             <span class="comment">% get the visible PrePol Ramp parameter axis and data</span>
0581             T2 = prepol.t.*1e3;
0582             <span class="keyword">switch</span> get(gui.panels.Plot.PrePol,<span class="string">'Selection'</span>)
0583                 <span class="keyword">case</span> 1
0584                     ax3 = gui.axes_handles.Bpre;
0585                     Bval = prepol.Bp./data.basic.B0;
0586                     ylab = <span class="string">'Bp [B0]'</span>;
0587                 <span class="keyword">case</span> 2
0588                     ax3 = gui.axes_handles.alpha;
0589                     Bval = rad2deg(prepol.alpha);
0590                     ylab = <span class="string">'\alpha [deg]'</span>;
0591                 <span class="keyword">case</span> 3
0592                     ax3 = gui.axes_handles.dadt;
0593                     Bval = prepol.dadt;
0594                     ylab = <span class="string">'d\alpha / dt'</span>;
0595                 <span class="keyword">case</span> 4
0596                     ax3 = gui.axes_handles.wda;
0597                     Bval = prepol.dadt./prepol.omega(1:numel(prepol.dadt));
0598                     Bval = [Bval;Bval(end)];
0599                     ylab = <span class="string">'(d\alpha/dt) / \gammaB'</span>;
0600             <span class="keyword">end</span>
0601             Bylim = get(ax3,<span class="string">'YLim'</span>);
0602             
0603             <span class="comment">% get the visible Pulse parameter axes and data</span>
0604             T3 = pulse.t;
0605             <span class="comment">% switch for df/I modulation axes</span>
0606             showdual = false;
0607             <span class="keyword">switch</span> get(gui.panels.Plot.Pulse,<span class="string">'Selection'</span>)
0608                 <span class="keyword">case</span> 1
0609                     ax4a = gui.axes_handles.PulseSetupF;
0610                     ax4b = gui.axes_handles.PulseSetupI;
0611                     P1 = [pulse.df pulse.I];
0612                     ylaba = <span class="string">'df [Hz]'</span>;
0613                     ylabb = <span class="string">'I [A]'</span>;
0614                     Pylima = get(ax4a,<span class="string">'YLim'</span>);
0615                     Pylimb = get(ax4b,<span class="string">'YLim'</span>);
0616                     showdual = true;
0617                 <span class="keyword">case</span> {2,3}
0618                     ax4 = gui.axes_handles.PulseB;
0619                     P1 = pulse.Bxy./data.basic.B0;
0620                     ylab = <span class="string">'B_1 [B_0]'</span>;
0621                     <span class="comment">% if FFT is visible, set axes to pulse amplitude</span>
0622                     set(gui.panels.Plot.Pulse,<span class="string">'Selection'</span>,2)
0623                     Pylim = get(ax4,<span class="string">'YLim'</span>);
0624             <span class="keyword">end</span>
0625 
0626             <span class="comment">% time vector</span>
0627             dt = Tsim(end)/NoFrames;
0628             <span class="comment">% including all relevant time markers</span>
0629             t = unique([0:dt:Tsim Tramp Tramp+Twait Tramp+Twait+Ttau]);
0630             <span class="comment">% adapt the number frames</span>
0631             NoFrames = numel(t);
0632 
0633             <span class="comment">% initialize all axes and animation lines</span>
0634             axes(ax1);
0635             cla(ax1);
0636             hMx = animatedline(<span class="string">'Color'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0637             hMy = animatedline(<span class="string">'Color'</span>,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0638             hMz = animatedline(<span class="string">'Color'</span>,<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0639             hMxy = animatedline(<span class="string">'Color'</span>,<span class="string">'m'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax1);
0640             hMn = animatedline(<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="string">'Parent'</span>,ax1);
0641             set(get(ax1,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0642             set(get(ax1,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'magnetization M'</span>);
0643             grid(ax1,<span class="string">'on'</span>);
0644             set(ax1,<span class="string">'FontSize'</span>,myui.axfontsize);
0645             
0646             axes(ax2);
0647             cla(ax2);
0648             hold(ax2,<span class="string">'on'</span>);
0649             <a href="../../../blochus/functions/interface/plotBSphere.html" class="code" title="function bsh = plotBSphere(dlat,dlong,ax,varargin)">plotBSphere</a>(18,18,ax2);
0650             h3dMa = animatedline(<span class="string">'Color'</span>,myui.color.prepol,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0651             h3dMb = animatedline(<span class="string">'Color'</span>,myui.color.wait,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0652             h3dMc = animatedline(<span class="string">'Color'</span>,myui.color.pulse,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0653             h3dMd = animatedline(<span class="string">'Color'</span>,myui.color.basic,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0654             h3dB = animatedline(<span class="string">'Color'</span>,myui.color.prepolB,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax2);
0655             
0656             axes(ax3);
0657             <a href="../../../blochus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(ax3);
0658             hB = animatedline(<span class="string">'Color'</span>,myui.color.prepolB,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax3);
0659             set(get(ax3,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0660             set(get(ax3,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,ylab);
0661             grid(ax3,<span class="string">'on'</span>);
0662             set(ax3,<span class="string">'FontSize'</span>,myui.axfontsize);
0663             
0664             <span class="keyword">if</span> showdual
0665                 <a href="../../../blochus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(ax4a);
0666                 hPx = animatedline(<span class="string">'Color'</span>,myui.color.pulse,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax4a);
0667                 set(get(ax4a,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0668                 set(get(ax4a,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,ylaba);
0669                 grid(ax4a,<span class="string">'on'</span>);
0670                 set(ax4a,<span class="string">'FontSize'</span>,myui.axfontsize);
0671                 
0672                 <a href="../../../blochus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(ax4b);
0673                 hPy = animatedline(<span class="string">'Color'</span>,myui.color.pulse,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax4b);
0674                 set(get(ax4b,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0675                 set(get(ax4b,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,ylabb);
0676                 grid(ax4b,<span class="string">'on'</span>);
0677                 set(ax4b,<span class="string">'FontSize'</span>,myui.axfontsize);
0678             <span class="keyword">else</span>
0679                 <a href="../../../blochus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(ax4);
0680                 hPx = animatedline(<span class="string">'Color'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax4);
0681                 hPy = animatedline(<span class="string">'Color'</span>,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2,<span class="string">'Parent'</span>,ax4);
0682                 set(get(ax4,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'t [ms]'</span>);
0683                 set(get(ax4,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,ylab);
0684                 grid(ax4,<span class="string">'on'</span>);
0685                 set(ax4,<span class="string">'FontSize'</span>,myui.axfontsize);
0686             <span class="keyword">end</span>
0687             
0688             <span class="comment">% loop over the data</span>
0689             <span class="keyword">for</span> nf = 1:NoFrames-1
0690                 <span class="comment">% get the index vector of the current M data to plot</span>
0691                 indt = T1&gt;=t(nf) &amp; T1&lt;t(nf+1);
0692                 <span class="comment">% get the current time vector for M</span>
0693                 x1 = T1(indt);
0694                 <span class="comment">% get data to plot for M</span>
0695                 yMx = M1(indt,1);
0696                 yMy = M1(indt,2);
0697                 yMz = M1(indt,3);
0698                 yMxx = M2(indt,1)./Mamp(1);
0699                 yMyy = M2(indt,2)./Mamp(1);
0700                 yMzz = M2(indt,3)./Mamp(1);
0701                 yMxy = Mxy(indt,1);
0702                 yMn = Mamp(indt,1);
0703                 
0704                 <span class="comment">% plot M into the left panel</span>
0705                 addpoints(hMx,x1,yMx);
0706                 addpoints(hMy,x1,yMy);
0707                 addpoints(hMz,x1,yMz);
0708                 addpoints(hMxy,x1,yMxy);
0709                 addpoints(hMn,x1,yMn);
0710                 <span class="comment">% M axis settings</span>
0711                 set(ax1,<span class="string">'XLim'</span>,[min(T1) max(T1)],<span class="string">'YLim'</span>,Mylim);
0712                 lh = legend(ax1,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>,<span class="string">'|xy|'</span>,<span class="string">'|M|'</span>,<span class="string">'Location'</span>,<span class="string">'SouthWest'</span>);
0713                 
0714                 <span class="comment">% plot into the Bloch sphere</span>
0715                 <span class="comment">% as long as we are in the &quot;pulse&quot; phase</span>
0716                 <span class="keyword">if</span> t(nf) &lt; Tramp
0717                     indt2 = T2&gt;t(nf) &amp; T2&lt;=t(nf+1); <span class="comment">% t2?</span>
0718                     yBx = Beffn(indt2,1);
0719                     yBy = Beffn(indt2,2);
0720                     yBz = Beffn(indt2,3);
0721                     yBramp = Bval(indt2,1);
0722                     
0723                     <span class="comment">% add the M data to the sphere (prepol color)</span>
0724                     addpoints(h3dMa,yMxx,yMyy,yMzz);
0725                     <span class="comment">% add the B-field trace to the sphere</span>
0726                     addpoints(h3dB,yBx,yBy,yBz);
0727                 <span class="keyword">elseif</span> t(nf)&gt;Tramp &amp;&amp; t(nf) &lt;= Tramp+Twait
0728                     <span class="comment">% add the M data to the sphere (wait color)</span>
0729                     addpoints(h3dMb,yMxx,yMyy,yMzz);
0730                 <span class="keyword">elseif</span> t(nf)&gt;Tramp+Twait &amp;&amp; t(nf) &lt;= Tsim-Trelax
0731                     <span class="comment">% add the M data to the sphere (pulse color)</span>
0732                     addpoints(h3dMc,yMxx,yMyy,yMzz);
0733                 <span class="keyword">elseif</span> t(nf) &gt; Tsim-Trelax
0734                     <span class="comment">% after the pulse is over</span>
0735                     <span class="comment">% add the M data to the sphere (basic color)</span>
0736                     addpoints(h3dMd,yMxx,yMyy,yMzz);
0737                 <span class="keyword">end</span>
0738                 <span class="comment">% sphere axis settings</span>
0739                 view(ax2,Mview);
0740                 set(ax2,<span class="string">'XLim'</span>,[-1.05 1.05],<span class="string">'YLim'</span>,[-1.05 1.05],<span class="string">'ZLim'</span>,[-1.05 1.05])
0741                 set(ax2,<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'XColor'</span>,<span class="string">'none'</span>,<span class="string">'YColor'</span>,<span class="string">'none'</span>,<span class="string">'ZColor'</span>,<span class="string">'none'</span>);
0742                 axis(ax2,<span class="string">'equal'</span>);
0743                 axis(ax2,<span class="string">'tight'</span>);
0744                 
0745                 <span class="comment">% plot the ramp parameter</span>
0746                 <span class="keyword">if</span> t(nf) &lt; Tramp
0747                     x2 = T2(indt2);
0748                     addpoints(hB,x2,yBramp);
0749                     set(ax3,<span class="string">'XLim'</span>,[min(T2) max(T2)],<span class="string">'YLim'</span>,Bylim);
0750                 <span class="keyword">end</span>
0751                 
0752                 <span class="comment">% plot the Pulse parameter</span>
0753                 <span class="keyword">if</span> t(nf)&gt;=Tramp+Twait &amp;&amp; t(nf) &lt; Tsim-Trelax
0754                     indt3 = T3+Tramp+Twait&gt;=t(nf) &amp; T3+Tramp+Twait&lt;t(nf+1);
0755                     x3 = T3(indt3);
0756                     yBx = P1(indt3,1);
0757                     yBy = P1(indt3,2);
0758                     
0759                     addpoints(hPx,x3,yBx);
0760                     addpoints(hPy,x3,yBy);
0761                     <span class="keyword">if</span> showdual
0762                         set(ax4a,<span class="string">'XLim'</span>,[min(T3) max(T3)],<span class="string">'YLim'</span>,Pylima);
0763                         lh = legend(ax4a,<span class="string">'df mod.'</span>,<span class="string">'Location'</span>,<span class="string">'SouthEast'</span>);
0764                         
0765                         set(ax4b,<span class="string">'XLim'</span>,[min(T3) max(T3)],<span class="string">'YLim'</span>,Pylimb);
0766                         lh = legend(ax4b,<span class="string">'I mod.'</span>,<span class="string">'Location'</span>,<span class="string">'SouthEast'</span>);
0767                     <span class="keyword">else</span>
0768                         set(ax4,<span class="string">'XLim'</span>,[min(T3) max(T3)],<span class="string">'YLim'</span>,Pylim);
0769                         lh = legend(ax4,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'Location'</span>,<span class="string">'SouthWest'</span>);
0770                     <span class="keyword">end</span>
0771                 <span class="keyword">end</span>
0772                 
0773                 <span class="comment">% pause a bit to show the animation</span>
0774                 <span class="comment">% drawnow limitrate works also but is a bit too fast</span>
0775                 pause(1/24);
0776                 <span class="comment">% drawnow limitrate;</span>
0777                 
0778             <span class="keyword">end</span>
0779             hold(ax1,<span class="string">'off'</span>);
0780             hold(ax2,<span class="string">'off'</span>);
0781             hold(ax3,<span class="string">'off'</span>);
0782             <span class="keyword">if</span> showdual
0783                 hold(ax4a,<span class="string">'off'</span>);
0784                 hold(ax4b,<span class="string">'off'</span>);
0785             <span class="keyword">else</span>
0786                 hold(ax4,<span class="string">'off'</span>);
0787             <span class="keyword">end</span>
0788             <span class="comment">% show the Ramp parameter again</span>
0789             <a href="../../../blochus/functions/interface/plotRamp.html" class="code" title="function plotRamp(fig)">plotRamp</a>(fig);
0790             <span class="comment">% show the Pulse parameter again</span>
0791             <a href="../../../blochus/functions/interface/plotPulse.html" class="code" title="function plotPulse(fig)">plotPulse</a>(fig);    
0792     <span class="keyword">end</span>
0793     
0794     <span class="comment">% reset the pushbutton color</span>
0795     set(src,<span class="string">'BackGroundColor'</span>,[.94 .94 .94]);
0796     <span class="comment">% update the status info</span>
0797     set(gui.text_handles.Status,<span class="string">'String'</span>,<span class="string">'Animation running ... finished.'</span>);
0798     <span class="comment">% done</span>
0799     pause(0.01);
0800     <span class="comment">% show the results parameter again</span>
0801     <a href="../../../blochus/functions/interface/plotResults.html" class="code" title="function plotResults(fig)">plotResults</a>(fig);
0802     
0803 <span class="keyword">else</span>
0804     warndlg({<span class="string">'onPushAnimate:'</span>,<span class="string">'There is no figure with the BLOCHUS Tag open.'</span>},<span class="keyword">...</span>
0805         <span class="string">'BLOCHUS error'</span>);
0806 <span class="keyword">end</span>
0807 
0808 <span class="keyword">end</span>
0809 
0810 <span class="comment">%------------- END OF CODE --------------</span>
0811 
0812 <span class="comment">%% License:</span>
0813 <span class="comment">% GNU GPLv3</span>
0814 <span class="comment">%</span>
0815 <span class="comment">% BLOCHUS</span>
0816 <span class="comment">% Copyright (C) 2019 Thomas Hiller</span>
0817 <span class="comment">%</span>
0818 <span class="comment">% This program is free software: you can redistribute it and/or modify</span>
0819 <span class="comment">% it under the terms of the GNU General Public License as published by</span>
0820 <span class="comment">% the Free Software Foundation, either version 3 of the License, or</span>
0821 <span class="comment">% (at your option) any later version.</span>
0822 <span class="comment">%</span>
0823 <span class="comment">% This program is distributed in the hope that it will be useful,</span>
0824 <span class="comment">% but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0825 <span class="comment">% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0826 <span class="comment">% GNU General Public License for more details.</span>
0827 <span class="comment">%</span>
0828 <span class="comment">% You should have received a copy of the GNU General Public License</span>
0829 <span class="comment">% along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>